{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"pykabu-calendar","text":"<p>Japanese earnings calendar aggregator.</p> <p></p>"},{"location":"#overview","title":"Overview","text":"<p>pykabu-calendar aggregates earnings announcement data from multiple Japanese broker sites and produces the most accurate earnings datetime calendar possible.</p>"},{"location":"#why-accurate-datetime-matters","title":"Why accurate datetime matters","text":"<p>Some companies announce earnings during trading hours (zaraba: 9:00-11:30, 12:30-15:30). Knowing the exact announcement time allows traders to:</p> <ul> <li>Position before announcements</li> <li>React quickly to results</li> <li>Avoid unexpected volatility</li> </ul>"},{"location":"#data-source-hierarchy","title":"Data source hierarchy","text":"<ol> <li>Inferred + Source match - When historical pattern matches a source (high confidence)</li> <li>Historical patterns - Inferred from past announcement times via pykabutan</li> <li>SBI Securities - Primary public source (requires Playwright)</li> <li>Matsui/Tradersweb - Lightweight sources (default)</li> </ol>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>import pykabu_calendar as cal\n\n# Get earnings calendar for a specific date\ndf = cal.get_calendar(\"2026-02-10\")\n\n# Include SBI (requires Playwright)\ndf = cal.get_calendar(\"2026-02-10\", include_sbi=True)\n\n# Without historical inference (faster)\ndf = cal.get_calendar(\"2026-02-10\", infer_from_history=False)\n\n# Export to CSV for Google Sheets\ncal.export_to_csv(df, \"earnings.csv\")\n</code></pre>"},{"location":"#output-columns","title":"Output Columns","text":"Column Description <code>code</code> Stock code (e.g., \"7203\") <code>name</code> Company name <code>datetime</code> Best estimate datetime <code>candidate_datetimes</code> List of candidate datetimes (most likely first) <code>sbi_datetime</code> Datetime from SBI (if available) <code>matsui_datetime</code> Datetime from Matsui <code>tradersweb_datetime</code> Datetime from Tradersweb <code>inferred_datetime</code> Datetime inferred from history <code>past_datetimes</code> List of past earnings datetimes"},{"location":"#features","title":"Features","text":"<ul> <li>Aggregates earnings calendars from SBI, Matsui, Tradersweb</li> <li>Infers announcement time from historical patterns (via pykabutan)</li> <li>Centralized URL configuration for easy maintenance</li> <li>Modern User-Agent for reliable scraping</li> <li>Exports to CSV (Google Sheets compatible)</li> </ul>"},{"location":"#installation","title":"Installation","text":"<pre><code>pip install pykabu-calendar\n</code></pre> <p>For SBI scraping: <pre><code>pip install playwright &amp;&amp; playwright install chromium\n</code></pre></p> <p>See Installation for more options.</p>"},{"location":"api/","title":"API Reference","text":""},{"location":"api/#main-functions","title":"Main Functions","text":""},{"location":"api/#get_calendar","title":"get_calendar","text":"<pre><code>def get_calendar(\n    target_date: str,\n    sources: list[str] = [\"sbi\", \"matsui\", \"tradersweb\"],\n    infer_from_history: bool = True,\n    verify_official: bool = False,\n    eager: bool = False,\n) -&gt; pd.DataFrame:\n    \"\"\"\n    Get earnings calendar for a specific date.\n\n    Args:\n        target_date: Date string in \"YYYY-MM-DD\" format\n        sources: List of calendar sources to scrape\n        infer_from_history: Whether to infer time from historical patterns\n        verify_official: Whether to check company IR pages\n        eager: If True, ignore cache and re-check all IR pages\n\n    Returns:\n        DataFrame with earnings calendar data\n    \"\"\"\n</code></pre>"},{"location":"api/#get_calendars","title":"get_calendars","text":"<pre><code>def get_calendars(\n    year_month: str,\n    start_day: int = 1,\n    **kwargs,\n) -&gt; list[pd.DataFrame]:\n    \"\"\"\n    Get earnings calendars for multiple days in a month.\n\n    Args:\n        year_month: Year and month in \"YYYY-MM\" format\n        start_day: Day to start from (default: 1)\n        **kwargs: Passed to get_calendar()\n\n    Returns:\n        List of DataFrames, one per trading day\n    \"\"\"\n</code></pre>"},{"location":"api/#configure","title":"configure","text":"<pre><code>def configure(\n    llm_provider: str = \"ollama\",\n    llm_model: str = \"llama3.2\",\n    timeout: int = 30,\n    parallel_workers: int = 5,\n    cache_path: str = None,\n) -&gt; None:\n    \"\"\"\n    Configure library settings.\n\n    Args:\n        llm_provider: LLM provider (\"ollama\", \"anthropic\", \"openai\")\n        llm_model: Model name\n        timeout: Seconds per company for IR discovery\n        parallel_workers: Concurrent IR verification workers\n        cache_path: Custom cache directory path\n    \"\"\"\n</code></pre>"},{"location":"api/#output-columns","title":"Output Columns","text":"Column Type Description <code>code</code> str Stock code (e.g., \"7203\") <code>name</code> str Company name in Japanese <code>datetime</code> datetime Best guess announcement datetime <code>datetime_source</code> str Source of datetime (\"sbi\", \"inferred\", \"official\") <code>date</code> date Announcement date <code>time_sbi</code> str Time from SBI calendar <code>time_matsui</code> str Time from Matsui calendar <code>time_tradersweb</code> str Time from Tradersweb calendar <code>time_inferred</code> str Time inferred from history <code>time_official</code> str Time from company IR <code>type</code> str Earnings type (Q1, Q2, Q3, \u672c\u6c7a\u7b97) <code>ir_url</code> str Cached IR page URL <code>publishes_time</code> bool Whether company publishes exact time <code>confidence</code> str Confidence level (high, medium, low)"},{"location":"api/#source-classes","title":"Source Classes","text":""},{"location":"api/#basecalendarscraper","title":"BaseCalendarScraper","text":"<pre><code>class BaseCalendarScraper(ABC):\n    \"\"\"Abstract base class for calendar scrapers.\"\"\"\n\n    @abstractmethod\n    def get_calendar(self, target_date: str) -&gt; pd.DataFrame:\n        \"\"\"Scrape calendar for target date.\"\"\"\n        pass\n</code></pre>"},{"location":"api/#sbicalendarscraper","title":"SbiCalendarScraper","text":"<pre><code>class SbiCalendarScraper(BaseCalendarScraper):\n    \"\"\"SBI Securities earnings calendar scraper.\"\"\"\n    pass\n</code></pre>"},{"location":"api/#matsuicalendarscraper","title":"MatsuiCalendarScraper","text":"<pre><code>class MatsuiCalendarScraper(BaseCalendarScraper):\n    \"\"\"Matsui Securities earnings calendar scraper.\"\"\"\n    pass\n</code></pre>"},{"location":"api/#exceptions","title":"Exceptions","text":"<pre><code>class CalendarScraperError(Exception):\n    \"\"\"Base exception for scraper errors.\"\"\"\n    pass\n\nclass SourceUnavailableError(CalendarScraperError):\n    \"\"\"Raised when a calendar source is unavailable.\"\"\"\n    pass\n\nclass IRDiscoveryError(CalendarScraperError):\n    \"\"\"Raised when IR page discovery fails.\"\"\"\n    pass\n</code></pre>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#basic-installation","title":"Basic Installation","text":"<pre><code>pip install pykabu-calendar\n</code></pre> <p>Or with <code>uv</code>:</p> <pre><code>uv pip install pykabu-calendar\n</code></pre>"},{"location":"getting-started/installation/#optional-dependencies","title":"Optional Dependencies","text":""},{"location":"getting-started/installation/#llm-support","title":"LLM Support","text":"<p>For IR page discovery using local LLMs:</p> <pre><code>pip install pykabu-calendar[llm]\n</code></pre> <p>This installs Ollama client. You'll also need Ollama running locally:</p> <pre><code># Install Ollama (macOS)\nbrew install ollama\n\n# Pull a model\nollama pull llama3.2\n\n# Start Ollama server\nollama serve\n</code></pre>"},{"location":"getting-started/installation/#browser-support","title":"Browser Support","text":"<p>If some calendar sites require JavaScript rendering:</p> <pre><code>pip install pykabu-calendar[browser]\n</code></pre> <p>Note</p> <p>Browser dependencies are only added if needed. The library tries lightweight approaches first.</p>"},{"location":"getting-started/installation/#development","title":"Development","text":"<p>For contributing or running tests:</p> <pre><code>pip install pykabu-calendar[dev]\n</code></pre>"},{"location":"getting-started/installation/#everything","title":"Everything","text":"<pre><code>pip install pykabu-calendar[all]\n</code></pre>"},{"location":"getting-started/installation/#from-source","title":"From Source","text":"<pre><code>git clone https://github.com/obichan117/pykabu-calendar.git\ncd pykabu-calendar\nuv venv &amp;&amp; source .venv/bin/activate\nuv pip install -e \".[dev]\"\n</code></pre>"},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.11+</li> <li>macOS, Linux, or Windows</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":""},{"location":"getting-started/quickstart/#basic-usage","title":"Basic Usage","text":"<p>Get the earnings calendar for a specific date:</p> <pre><code>import pykabu_calendar as cal\n\n# Get calendar for February 10, 2026\ndf = cal.get_calendar(\"2026-02-10\")\n\nprint(df[[\"code\", \"name\", \"datetime\", \"inferred_datetime\"]])\n</code></pre> <p>Output:</p> <pre><code>   code             name            datetime   inferred_datetime\n0  1414   \u30b7\u30e7\u30fc\u30dc\u30f3\u30c9\u30db\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u30b9 2026-02-10 15:30:00 2026-02-10 15:30:00\n1  1446           \u30ad\u30e3\u30f3\u30c7\u30a3\u30eb 2026-02-10 15:30:00 2026-02-10 15:30:00\n2  167A  \u30ea\u30e7\u30fc\u30b5\u30f3\u83f1\u6d0b\u30db\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u30b9 2026-02-10 16:00:00 2026-02-10 16:00:00\n...\n</code></pre>"},{"location":"getting-started/quickstart/#including-sbi-data","title":"Including SBI Data","text":"<p>SBI Securities provides the most comprehensive calendar but requires browser automation:</p> <pre><code># Install Playwright first:\n# pip install playwright &amp;&amp; playwright install chromium\n\n# Include SBI data\ndf = cal.get_calendar(\"2026-02-10\", include_sbi=True)\n\n# Check SBI-specific datetime\nprint(df[[\"code\", \"name\", \"datetime\", \"sbi_datetime\"]])\n</code></pre>"},{"location":"getting-started/quickstart/#without-historical-inference","title":"Without Historical Inference","text":"<p>For faster results, disable historical inference:</p> <pre><code># Faster, but less accurate\ndf = cal.get_calendar(\"2026-02-10\", infer_from_history=False)\n</code></pre>"},{"location":"getting-started/quickstart/#viewing-past-datetimes","title":"Viewing Past Datetimes","text":"<p>Each row includes historical earnings announcement times:</p> <pre><code>df = cal.get_calendar(\"2026-02-10\")\n\n# Check past earnings times for first company\nrow = df.iloc[0]\nprint(f\"Company: {row['name']}\")\nprint(f\"Past announcements: {row['past_datetimes']}\")\n</code></pre> <p>Output:</p> <pre><code>Company: \u30b7\u30e7\u30fc\u30dc\u30f3\u30c9\u30db\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u30b9\nPast announcements: [Timestamp('2025-11-10 15:30:00'), Timestamp('2025-08-12 15:30:00'), ...]\n</code></pre>"},{"location":"getting-started/quickstart/#candidate-datetimes","title":"Candidate Datetimes","text":"<p>The <code>candidate_datetimes</code> column shows all possible times, ordered by confidence:</p> <pre><code>df = cal.get_calendar(\"2026-02-10\")\n\n# When inferred matches source data, it's listed first (high confidence)\nprint(df[[\"code\", \"name\", \"candidate_datetimes\"]].head())\n</code></pre>"},{"location":"getting-started/quickstart/#export-to-csv","title":"Export to CSV","text":"<pre><code>df = cal.get_calendar(\"2026-02-10\")\n\n# Use the built-in export function (handles list columns)\ncal.export_to_csv(df, \"earnings_2026-02-10.csv\")\n\n# Or use pandas directly\ndf.to_csv(\"earnings.csv\", index=False, encoding=\"utf-8-sig\")\n</code></pre> <p>The <code>utf-8-sig</code> encoding ensures Excel and Google Sheets handle Japanese characters correctly.</p>"},{"location":"getting-started/quickstart/#output-columns","title":"Output Columns","text":"Column Description <code>code</code> Stock code (e.g., \"7203\") <code>name</code> Company name <code>datetime</code> Best guess announcement datetime <code>candidate_datetimes</code> List of candidate datetimes (most likely first) <code>sbi_datetime</code> Datetime from SBI <code>matsui_datetime</code> Datetime from Matsui <code>tradersweb_datetime</code> Datetime from Tradersweb <code>inferred_datetime</code> Datetime inferred from history <code>past_datetimes</code> List of past earnings datetimes"},{"location":"getting-started/quickstart/#using-individual-scrapers","title":"Using Individual Scrapers","text":"<p>You can also use individual scrapers directly:</p> <pre><code>from pykabu_calendar import fetch_matsui, fetch_tradersweb, fetch_sbi\n\n# Matsui (lightweight)\ndf_matsui = fetch_matsui(\"2026-02-10\")\n\n# Tradersweb (lightweight)\ndf_tradersweb = fetch_tradersweb(\"2026-02-10\")\n\n# SBI (requires Playwright)\ndf_sbi = fetch_sbi(\"2026-02-10\")\n</code></pre>"},{"location":"guide/configuration/","title":"Configuration","text":""},{"location":"guide/configuration/#basic-configuration","title":"Basic Configuration","text":"<pre><code>import pykabu_calendar as cal\n\ncal.configure(\n    llm_provider=\"ollama\",\n    llm_model=\"llama3.2\",\n    timeout=30,\n    parallel_workers=5,\n)\n</code></pre>"},{"location":"guide/configuration/#options","title":"Options","text":"Option Default Description <code>llm_provider</code> <code>\"ollama\"</code> LLM provider for IR discovery <code>llm_model</code> <code>\"llama3.2\"</code> Model name <code>timeout</code> <code>30</code> Seconds per company for IR discovery <code>parallel_workers</code> <code>5</code> Concurrent IR verification workers <code>cache_path</code> <code>~/.pykabu_calendar/</code> Location for cache files"},{"location":"guide/configuration/#llm-providers","title":"LLM Providers","text":""},{"location":"guide/configuration/#ollama-default","title":"Ollama (Default)","text":"<p>Free, local, private. Requires Ollama installed:</p> <pre><code># Install\nbrew install ollama\n\n# Pull model\nollama pull llama3.2\n\n# Start server\nollama serve\n</code></pre> <pre><code>cal.configure(llm_provider=\"ollama\", llm_model=\"llama3.2\")\n</code></pre> <p>Available models:</p> <ul> <li><code>llama3.2</code> (3B) - Fast, good for simple tasks</li> <li><code>llama3.1</code> (8B) - Better reasoning</li> <li><code>mistral</code> (7B) - Good balance</li> <li><code>qwen2.5</code> (7B) - Strong for structured extraction</li> </ul>"},{"location":"guide/configuration/#future-claude-api","title":"Future: Claude API","text":"<p>Not yet implemented. Would require API key:</p> <pre><code>cal.configure(\n    llm_provider=\"anthropic\",\n    llm_model=\"claude-3-haiku\",\n    api_key=\"sk-...\"\n)\n</code></pre>"},{"location":"guide/configuration/#cache-location","title":"Cache Location","text":"<p>Default: <code>~/.pykabu_calendar/</code></p> <p>Contents:</p> <ul> <li><code>ir_cache.json</code> - Discovered IR URLs and policies</li> </ul> <p>Override:</p> <pre><code>cal.configure(cache_path=\"/path/to/custom/cache/\")\n</code></pre>"},{"location":"guide/configuration/#environment-variables","title":"Environment Variables","text":"<p>For future API key support:</p> <pre><code>export ANTHROPIC_API_KEY=\"sk-...\"\nexport OPENAI_API_KEY=\"sk-...\"\n</code></pre>"},{"location":"guide/configuration/#default-sources","title":"Default Sources","text":"<pre><code># These are the defaults\ncal.get_calendar(\n    \"2025-02-14\",\n    sources=[\"sbi\", \"matsui\", \"tradersweb\"],\n    infer_from_history=True,\n    verify_official=False,\n    eager=False,\n)\n</code></pre>"},{"location":"guide/official-ir/","title":"Official IR Verification","text":"<p>The most accurate earnings datetime comes from company investor relations (IR) pages. This feature attempts to discover and parse official announcement times.</p>"},{"location":"guide/official-ir/#how-it-works","title":"How It Works","text":"<pre><code>df = cal.get_calendar(\"2025-02-14\", verify_official=True)\n</code></pre> <p>For each company in the calendar:</p> <ol> <li>Check cache - Skip if we already know this company's IR URL and policy</li> <li>Check if significant - Skip if time &gt;= 15:30 (after-hours, doesn't affect trading)</li> <li>Try pattern matching - Look for common IR URL patterns</li> <li>LLM fallback - Use local LLM to discover IR page</li> <li>Parse datetime - Extract announcement time from IR page</li> <li>Cache result - Save URL and <code>publishes_time</code> policy for future</li> </ol>"},{"location":"guide/official-ir/#trading-hours-optimization","title":"Trading Hours Optimization","text":"<p>Only companies announcing during trading hours (zaraba) are checked:</p> Session Time Morning 9:00 - 11:30 Afternoon 12:30 - 15:30 <p>If the scraped time is after 15:30, official verification is skipped since the exact time doesn't affect trading decisions.</p>"},{"location":"guide/official-ir/#caching","title":"Caching","text":"<p>Discovered IR paths are cached for future use:</p> <pre><code>{\n  \"7203\": {\n    \"ir_url\": \"https://global.toyota/jp/ir/calendar/\",\n    \"publishes_time\": true,\n    \"last_checked\": \"2025-01-15\"\n  },\n  \"6758\": {\n    \"ir_url\": \"https://www.sony.com/ja/SonyInfo/IR/\",\n    \"publishes_time\": false,\n    \"last_checked\": \"2025-01-15\"\n  }\n}\n</code></pre> <ul> <li><code>publishes_time: true</code> - Company publishes exact time, check each season</li> <li><code>publishes_time: false</code> - Company only publishes date, skip time verification</li> </ul>"},{"location":"guide/official-ir/#eager-mode","title":"Eager Mode","text":"<p>Occasionally refresh the cache to catch policy changes:</p> <pre><code># Normal mode - respects cache\ndf = cal.get_calendar(\"2025-02-14\", verify_official=True)\n\n# Eager mode - ignores cache, re-checks everything\ndf = cal.get_calendar(\"2025-02-14\", verify_official=True, eager=True)\n</code></pre> <p>Run eager mode quarterly or when you suspect policies have changed.</p>"},{"location":"guide/official-ir/#manual-path-input","title":"Manual Path Input","text":"<p>Users can manually add IR URLs to the cache:</p> <ol> <li>Open <code>~/.pykabu_calendar/ir_cache.json</code></li> <li>Add entry for the company</li> <li>Next run will use the cached path</li> </ol> <p>This is useful when automatic discovery fails but you know the URL.</p>"},{"location":"guide/official-ir/#timeout-behavior","title":"Timeout Behavior","text":"<ul> <li>Each company has a 30-second timeout</li> <li>If discovery fails, returns <code>None</code> and moves on</li> <li>Never blocks the entire calendar for one stubborn company</li> </ul>"},{"location":"guide/official-ir/#llm-configuration","title":"LLM Configuration","text":"<p>When pattern matching fails, a local LLM helps discover IR pages:</p> <pre><code>cal.configure(llm_provider=\"ollama\", llm_model=\"llama3.2\")\n</code></pre> <p>The LLM:</p> <ol> <li>Analyzes the company homepage</li> <li>Looks for IR-related links</li> <li>Navigates to find earnings calendar</li> <li>Learns from accumulated successful patterns</li> </ol>"},{"location":"guide/sources/","title":"Data Sources","text":"<p>pykabu-calendar aggregates earnings calendar data from multiple sources, each with different characteristics.</p>"},{"location":"guide/sources/#source-hierarchy","title":"Source Hierarchy","text":"Priority Source Description Reliability 1 Official IR Company investor relations pages Highest 2 Historical Inferred from past patterns High 3 SBI SBI Securities calendar Good (primary) 4 Matsui Matsui Securities calendar Good 5 Monex Monex Securities calendar Moderate 6 Tradersweb Tradersweb calendar Good"},{"location":"guide/sources/#sbi-securities-primary","title":"SBI Securities (Primary)","text":"<p>The SBI calendar is the most comprehensive public source for Japanese earnings dates.</p> <p>URL Pattern: <code>https://www.sbisec.co.jp/...</code></p> <p>Data provided:</p> <ul> <li>Announcement date and time</li> <li>Company code and name</li> <li>Earnings type (Q1, Q2, Q3, Full year)</li> <li>Result, guidance, and consensus estimates</li> <li>Percent gap (guidance vs consensus)</li> </ul> <p>Limitations:</p> <ul> <li>Time may be inaccurate or missing for some companies</li> <li>Updates may lag behind official announcements</li> </ul>"},{"location":"guide/sources/#matsui-securities","title":"Matsui Securities","text":"<p>Supplementary source that often confirms SBI data.</p> <p>Data provided:</p> <ul> <li>Announcement date and time</li> <li>Company code and name</li> <li>Earnings type</li> </ul>"},{"location":"guide/sources/#monex-securities","title":"Monex Securities","text":"<p>Smaller coverage, often a subset of SBI.</p> <p>Data provided:</p> <ul> <li>Announcement date and time</li> <li>Company code and name</li> <li>Earnings type</li> </ul>"},{"location":"guide/sources/#tradersweb","title":"Tradersweb","text":"<p>Independent source that can catch discrepancies.</p> <p>Data provided:</p> <ul> <li>Announcement date and time</li> <li>Company code and name</li> <li>Earnings type</li> </ul>"},{"location":"guide/sources/#historical-inference","title":"Historical Inference","text":"<p>Uses past announcement patterns from pykabutan to predict timing.</p> <p>Logic:</p> <ol> <li>Fetch past N earnings announcement times</li> <li>Detect patterns (e.g., \"always 13:00\", \"always after close\")</li> <li>Assign confidence based on consistency</li> </ol> <p>Example patterns:</p> <ul> <li>Company always announces at 13:00 \u2192 high confidence</li> <li>Company varies between 11:00-15:00 \u2192 low confidence</li> <li>Company always announces after 15:30 \u2192 not significant for trading</li> </ul>"},{"location":"guide/sources/#merging-strategy","title":"Merging Strategy","text":"<p>When sources disagree:</p> <ol> <li>Official IR time (if verified) takes precedence</li> <li>Historical inference (if consistent pattern exists)</li> <li>First available: SBI \u2192 Matsui \u2192 Tradersweb</li> </ol> <p>The <code>datetime_source</code> column indicates which source provided the final datetime.</p>"}]}