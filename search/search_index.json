{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"pykabu-calendar","text":"<p>Japanese earnings calendar aggregator.</p> <p></p>"},{"location":"#overview","title":"Overview","text":"<p>pykabu-calendar aggregates earnings announcement data from multiple Japanese broker sites and produces the most accurate earnings datetime calendar possible.</p>"},{"location":"#why-accurate-datetime-matters","title":"Why accurate datetime matters","text":"<p>Some companies announce earnings during trading hours (zaraba: 9:00-11:30, 12:30-15:30). Knowing the exact announcement time allows traders to:</p> <ul> <li>Position before announcements</li> <li>React quickly to results</li> <li>Avoid unexpected volatility</li> </ul>"},{"location":"#data-source-hierarchy","title":"Data source hierarchy","text":"<ol> <li>Inferred + Source match - When historical pattern matches a source (high confidence)</li> <li>Historical patterns - Inferred from past announcement times via pykabutan</li> <li>SBI Securities - Primary public source (requires Playwright)</li> <li>Matsui/Tradersweb - Lightweight sources (default)</li> </ol>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>import pykabu_calendar as cal\n\n# Get earnings calendar for a specific date\ndf = cal.get_calendar(\"2026-02-10\")\n\n# Include SBI (requires Playwright)\ndf = cal.get_calendar(\"2026-02-10\", include_sbi=True)\n\n# Without historical inference (faster)\ndf = cal.get_calendar(\"2026-02-10\", infer_from_history=False)\n\n# Export to CSV for Google Sheets\ncal.export_to_csv(df, \"earnings.csv\")\n</code></pre>"},{"location":"#output-columns","title":"Output Columns","text":"Column Description <code>code</code> Stock code (e.g., \"7203\") <code>name</code> Company name <code>datetime</code> Best estimate datetime <code>candidate_datetimes</code> List of candidate datetimes (most likely first) <code>sbi_datetime</code> Datetime from SBI (if available) <code>matsui_datetime</code> Datetime from Matsui <code>tradersweb_datetime</code> Datetime from Tradersweb <code>inferred_datetime</code> Datetime inferred from history <code>past_datetimes</code> List of past earnings datetimes"},{"location":"#features","title":"Features","text":"<ul> <li>Aggregates earnings calendars from SBI, Matsui, Tradersweb</li> <li>Infers announcement time from historical patterns (via pykabutan)</li> <li>Centralized URL configuration for easy maintenance</li> <li>Modern User-Agent for reliable scraping</li> <li>Exports to CSV (Google Sheets compatible)</li> </ul>"},{"location":"#installation","title":"Installation","text":"<pre><code>pip install pykabu-calendar\n</code></pre> <p>For SBI scraping: <pre><code>pip install playwright &amp;&amp; playwright install chromium\n</code></pre></p> <p>See Installation for more options.</p>"},{"location":"api/","title":"API Reference","text":""},{"location":"api/#main-functions","title":"Main Functions","text":""},{"location":"api/#get_calendar","title":"get_calendar","text":"<pre><code>def get_calendar(\n    date: str,\n    sources: list[str] | None = None,\n    include_sbi: bool = False,\n    infer_from_history: bool = True,\n) -&gt; pd.DataFrame:\n    \"\"\"\n    Get aggregated earnings calendar for a target date.\n\n    Args:\n        date: Date in YYYY-MM-DD format\n        sources: List of sources to use. Default: [\"matsui\", \"tradersweb\"]\n        include_sbi: If True, include SBI (requires Playwright)\n        infer_from_history: Whether to infer time from historical patterns\n\n    Returns:\n        DataFrame with earnings calendar data\n    \"\"\"\n</code></pre>"},{"location":"api/#export_to_csv","title":"export_to_csv","text":"<pre><code>def export_to_csv(df: pd.DataFrame, path: str) -&gt; None:\n    \"\"\"\n    Export calendar to CSV with proper encoding for Excel/Google Sheets.\n\n    Args:\n        df: Calendar DataFrame\n        path: Output file path\n    \"\"\"\n</code></pre>"},{"location":"api/#individual-scrapers","title":"Individual Scrapers","text":""},{"location":"api/#get_matsui","title":"get_matsui","text":"<pre><code>def get_matsui(date: str) -&gt; pd.DataFrame:\n    \"\"\"\n    Get earnings calendar from Matsui Securities.\n\n    Args:\n        date: Target date in YYYY-MM-DD format\n\n    Returns:\n        DataFrame with columns: [code, name, datetime]\n    \"\"\"\n</code></pre>"},{"location":"api/#get_tradersweb","title":"get_tradersweb","text":"<pre><code>def get_tradersweb(date: str) -&gt; pd.DataFrame:\n    \"\"\"\n    Get earnings calendar from Tradersweb.\n\n    Args:\n        date: Target date in YYYY-MM-DD format\n\n    Returns:\n        DataFrame with columns: [code, name, datetime]\n    \"\"\"\n</code></pre>"},{"location":"api/#get_sbi","title":"get_sbi","text":"<pre><code>def get_sbi(date: str) -&gt; pd.DataFrame:\n    \"\"\"\n    Get earnings calendar from SBI Securities.\n\n    Requires Playwright: pip install playwright &amp;&amp; playwright install chromium\n\n    Args:\n        date: Target date in YYYY-MM-DD format\n\n    Returns:\n        DataFrame with columns: [code, name, datetime]\n    \"\"\"\n</code></pre>"},{"location":"api/#inference-functions","title":"Inference Functions","text":""},{"location":"api/#get_past_earnings","title":"get_past_earnings","text":"<pre><code>def get_past_earnings(code: str, n_recent: int = 8) -&gt; list[pd.Timestamp]:\n    \"\"\"\n    Get past earnings announcement datetimes for a stock.\n\n    Uses pykabutan to fetch historical earnings data from kabutan.jp.\n\n    Args:\n        code: Stock code (e.g., \"7203\")\n        n_recent: Number of recent announcements to fetch\n\n    Returns:\n        List of past announcement timestamps\n    \"\"\"\n</code></pre>"},{"location":"api/#infer_datetime","title":"infer_datetime","text":"<pre><code>def infer_datetime(\n    code: str,\n    target_date: str,\n    n_recent: int = 8,\n) -&gt; tuple[pd.Timestamp | None, str, list[pd.Timestamp]]:\n    \"\"\"\n    Infer earnings announcement datetime from historical patterns.\n\n    Args:\n        code: Stock code (e.g., \"7203\")\n        target_date: Target date in YYYY-MM-DD format\n        n_recent: Number of recent announcements to consider\n\n    Returns:\n        Tuple of (inferred_datetime, confidence, past_datetimes)\n        - inferred_datetime: Predicted announcement time (or None)\n        - confidence: \"high\", \"medium\", or \"low\"\n        - past_datetimes: List of past announcement times used\n    \"\"\"\n</code></pre>"},{"location":"api/#is_during_trading_hours","title":"is_during_trading_hours","text":"<pre><code>def is_during_trading_hours(dt: pd.Timestamp) -&gt; bool:\n    \"\"\"\n    Check if a datetime is during Tokyo Stock Exchange trading hours.\n\n    Trading hours: 9:00-11:30, 12:30-15:00 JST\n\n    Args:\n        dt: Datetime to check\n\n    Returns:\n        True if during trading hours\n    \"\"\"\n</code></pre>"},{"location":"api/#output-columns","title":"Output Columns","text":"Column Type Description <code>code</code> str Stock code (e.g., \"7203\") <code>name</code> str Company name in Japanese <code>datetime</code> datetime Best estimate announcement datetime <code>candidate_datetimes</code> list List of candidate datetimes (most likely first) <code>sbi_datetime</code> datetime Datetime from SBI (if available) <code>matsui_datetime</code> datetime Datetime from Matsui <code>tradersweb_datetime</code> datetime Datetime from Tradersweb <code>inferred_datetime</code> datetime Datetime inferred from history <code>past_datetimes</code> list List of past earnings datetimes"},{"location":"api/#datetime-selection-priority","title":"Datetime Selection Priority","text":"<ol> <li>Inferred + Source match - When inferred time matches a source (high confidence)</li> <li>Inferred - From historical patterns</li> <li>SBI - Primary public source (requires Playwright)</li> <li>Matsui - Lightweight source</li> <li>Tradersweb - Lightweight source</li> </ol>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#basic-installation","title":"Basic Installation","text":"<pre><code>pip install pykabu-calendar\n</code></pre> <p>Or with <code>uv</code>:</p> <pre><code>uv pip install pykabu-calendar\n</code></pre>"},{"location":"getting-started/installation/#optional-dependencies","title":"Optional Dependencies","text":""},{"location":"getting-started/installation/#llm-support","title":"LLM Support","text":"<p>For IR page discovery using local LLMs:</p> <pre><code>pip install pykabu-calendar[llm]\n</code></pre> <p>This installs Ollama client. You'll also need Ollama running locally:</p> <pre><code># Install Ollama (macOS)\nbrew install ollama\n\n# Pull a model\nollama pull llama3.2\n\n# Start Ollama server\nollama serve\n</code></pre>"},{"location":"getting-started/installation/#browser-support","title":"Browser Support","text":"<p>If some calendar sites require JavaScript rendering:</p> <pre><code>pip install pykabu-calendar[browser]\n</code></pre> <p>Note</p> <p>Browser dependencies are only added if needed. The library tries lightweight approaches first.</p>"},{"location":"getting-started/installation/#development","title":"Development","text":"<p>For contributing or running tests:</p> <pre><code>pip install pykabu-calendar[dev]\n</code></pre>"},{"location":"getting-started/installation/#everything","title":"Everything","text":"<pre><code>pip install pykabu-calendar[all]\n</code></pre>"},{"location":"getting-started/installation/#from-source","title":"From Source","text":"<pre><code>git clone https://github.com/obichan117/pykabu-calendar.git\ncd pykabu-calendar\nuv venv &amp;&amp; source .venv/bin/activate\nuv pip install -e \".[dev]\"\n</code></pre>"},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.11+</li> <li>macOS, Linux, or Windows</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":""},{"location":"getting-started/quickstart/#basic-usage","title":"Basic Usage","text":"<p>Get the earnings calendar for a specific date:</p> <pre><code>import pykabu_calendar as cal\n\n# Get calendar for February 10, 2026\ndf = cal.get_calendar(\"2026-02-10\")\n\nprint(df[[\"code\", \"name\", \"datetime\", \"inferred_datetime\"]])\n</code></pre> <p>Output:</p> <pre><code>   code             name            datetime   inferred_datetime\n0  1414   \u30b7\u30e7\u30fc\u30dc\u30f3\u30c9\u30db\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u30b9 2026-02-10 15:30:00 2026-02-10 15:30:00\n1  1446           \u30ad\u30e3\u30f3\u30c7\u30a3\u30eb 2026-02-10 15:30:00 2026-02-10 15:30:00\n2  167A  \u30ea\u30e7\u30fc\u30b5\u30f3\u83f1\u6d0b\u30db\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u30b9 2026-02-10 16:00:00 2026-02-10 16:00:00\n...\n</code></pre>"},{"location":"getting-started/quickstart/#including-sbi-data","title":"Including SBI Data","text":"<p>SBI Securities provides the most comprehensive calendar but requires browser automation:</p> <pre><code># Install Playwright first:\n# pip install playwright &amp;&amp; playwright install chromium\n\n# Include SBI data\ndf = cal.get_calendar(\"2026-02-10\", include_sbi=True)\n\n# Check SBI-specific datetime\nprint(df[[\"code\", \"name\", \"datetime\", \"sbi_datetime\"]])\n</code></pre>"},{"location":"getting-started/quickstart/#without-historical-inference","title":"Without Historical Inference","text":"<p>For faster results, disable historical inference:</p> <pre><code># Faster, but less accurate\ndf = cal.get_calendar(\"2026-02-10\", infer_from_history=False)\n</code></pre>"},{"location":"getting-started/quickstart/#viewing-past-datetimes","title":"Viewing Past Datetimes","text":"<p>Each row includes historical earnings announcement times:</p> <pre><code>df = cal.get_calendar(\"2026-02-10\")\n\n# Check past earnings times for first company\nrow = df.iloc[0]\nprint(f\"Company: {row['name']}\")\nprint(f\"Past announcements: {row['past_datetimes']}\")\n</code></pre> <p>Output:</p> <pre><code>Company: \u30b7\u30e7\u30fc\u30dc\u30f3\u30c9\u30db\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u30b9\nPast announcements: [Timestamp('2025-11-10 15:30:00'), Timestamp('2025-08-12 15:30:00'), ...]\n</code></pre>"},{"location":"getting-started/quickstart/#candidate-datetimes","title":"Candidate Datetimes","text":"<p>The <code>candidate_datetimes</code> column shows all possible times, ordered by confidence:</p> <pre><code>df = cal.get_calendar(\"2026-02-10\")\n\n# When inferred matches source data, it's listed first (high confidence)\nprint(df[[\"code\", \"name\", \"candidate_datetimes\"]].head())\n</code></pre>"},{"location":"getting-started/quickstart/#export-to-csv","title":"Export to CSV","text":"<pre><code>df = cal.get_calendar(\"2026-02-10\")\n\n# Use the built-in export function (handles list columns)\ncal.export_to_csv(df, \"earnings_2026-02-10.csv\")\n\n# Or use pandas directly\ndf.to_csv(\"earnings.csv\", index=False, encoding=\"utf-8-sig\")\n</code></pre> <p>The <code>utf-8-sig</code> encoding ensures Excel and Google Sheets handle Japanese characters correctly.</p>"},{"location":"getting-started/quickstart/#output-columns","title":"Output Columns","text":"Column Description <code>code</code> Stock code (e.g., \"7203\") <code>name</code> Company name <code>datetime</code> Best guess announcement datetime <code>candidate_datetimes</code> List of candidate datetimes (most likely first) <code>sbi_datetime</code> Datetime from SBI <code>matsui_datetime</code> Datetime from Matsui <code>tradersweb_datetime</code> Datetime from Tradersweb <code>inferred_datetime</code> Datetime inferred from history <code>past_datetimes</code> List of past earnings datetimes"},{"location":"getting-started/quickstart/#using-individual-scrapers","title":"Using Individual Scrapers","text":"<p>You can also use individual scrapers directly:</p> <pre><code>import pykabu_calendar as cal\n\n# Matsui (lightweight)\ndf_matsui = cal.get_matsui(\"2026-02-10\")\n\n# Tradersweb (lightweight)\ndf_tradersweb = cal.get_tradersweb(\"2026-02-10\")\n\n# SBI (requires Playwright)\ndf_sbi = cal.get_sbi(\"2026-02-10\")\n</code></pre>"},{"location":"guide/configuration/","title":"Configuration","text":""},{"location":"guide/configuration/#shared-configuration","title":"Shared Configuration","text":"<p>The library uses centralized configuration in <code>pykabu_calendar/config.py</code>:</p> <pre><code># User-Agent for HTTP requests\nUSER_AGENT = (\n    \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) \"\n    \"AppleWebKit/537.36 (KHTML, like Gecko) \"\n    \"Chrome/131.0.0.0 Safari/537.36\"\n)\n\n# Request timeout in seconds\nTIMEOUT = 30\n\n# HTTP headers used for all requests\nHEADERS = {\n    \"User-Agent\": USER_AGENT,\n    \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\",\n    \"Accept-Language\": \"ja,en-US;q=0.7,en;q=0.3\",\n}\n</code></pre>"},{"location":"guide/configuration/#source-specific-configuration","title":"Source-Specific Configuration","text":"<p>Each data source has its own configuration in <code>sources/{source}/config.py</code>:</p>"},{"location":"guide/configuration/#matsui","title":"Matsui","text":"<pre><code># sources/matsui/config.py\nURL = \"https://finance.matsui.co.jp/find-by-schedule/index\"\nTABLE_SELECTOR = \"table.m-table\"\nDATE_FORMAT = \"%Y/%m/%d\"\n\ndef build_url(date: str, page: int = 1) -&gt; str:\n    # Builds URL like: .../index?d=2026/2/10&amp;kind=earnings&amp;p=1\n</code></pre>"},{"location":"guide/configuration/#tradersweb","title":"Tradersweb","text":"<pre><code># sources/tradersweb/config.py\nURL = \"https://www.traders.co.jp/stocks/earnings/calendar\"\n\ndef build_url(date: str) -&gt; str:\n    # Builds URL like: .../calendar/2026/02/10\n</code></pre>"},{"location":"guide/configuration/#sbi","title":"SBI","text":"<pre><code># sources/sbi/config.py\nURL = \"https://www.sbisec.co.jp/ETGate/...\"\n\ndef build_url(date: str) -&gt; str:\n    # Builds URL for SBI calendar page\n</code></pre>"},{"location":"guide/configuration/#modifying-urls","title":"Modifying URLs","text":"<p>If a data source changes their URL structure:</p> <ol> <li>Open <code>src/pykabu_calendar/sources/{source}/config.py</code></li> <li>Update the <code>URL</code> constant and/or <code>build_url()</code> function</li> <li>Update any CSS selectors if the page structure changed</li> </ol>"},{"location":"guide/configuration/#default-sources","title":"Default Sources","text":"<pre><code>import pykabu_calendar as cal\n\n# Default: uses matsui and tradersweb (lightweight, no browser needed)\ndf = cal.get_calendar(\"2026-02-10\")\n\n# Include SBI (requires Playwright browser)\ndf = cal.get_calendar(\"2026-02-10\", include_sbi=True)\n\n# Use specific sources only\ndf = cal.get_calendar(\"2026-02-10\", sources=[\"matsui\"])\n\n# Disable historical inference (faster)\ndf = cal.get_calendar(\"2026-02-10\", infer_from_history=False)\n</code></pre>"},{"location":"guide/configuration/#installing-playwright-for-sbi","title":"Installing Playwright for SBI","text":"<p>SBI requires browser automation because the site uses JavaScript rendering:</p> <pre><code>pip install playwright\nplaywright install chromium\n</code></pre> <p>Then use <code>include_sbi=True</code> in <code>get_calendar()</code>.</p>"},{"location":"guide/official-ir/","title":"Official IR Verification (Planned)","text":"<p>Not Yet Implemented</p> <p>This feature is planned for a future release. The documentation below describes the intended design.</p> <p>The most accurate earnings datetime comes from company investor relations (IR) pages. This feature would attempt to discover and parse official announcement times.</p>"},{"location":"guide/official-ir/#planned-behavior","title":"Planned Behavior","text":"<p>For each company in the calendar:</p> <ol> <li>Check cache - Skip if we already know this company's IR URL and policy</li> <li>Check if significant - Skip if time &gt;= 15:30 (after-hours, doesn't affect trading)</li> <li>Try pattern matching - Look for common IR URL patterns</li> <li>LLM fallback - Use local LLM to discover IR page</li> <li>Parse datetime - Extract announcement time from IR page</li> <li>Cache result - Save URL and <code>publishes_time</code> policy for future</li> </ol>"},{"location":"guide/official-ir/#trading-hours-optimization","title":"Trading Hours Optimization","text":"<p>Only companies announcing during trading hours (zaraba) would be checked:</p> Session Time Morning 9:00 - 11:30 Afternoon 12:30 - 15:00 <p>If the scraped time is after 15:30, official verification would be skipped since the exact time doesn't affect trading decisions.</p>"},{"location":"guide/official-ir/#current-alternative","title":"Current Alternative","text":"<p>For now, use historical inference which provides reasonably accurate predictions based on past patterns:</p> <pre><code>import pykabu_calendar as cal\n\n# Historical inference is enabled by default\ndf = cal.get_calendar(\"2026-02-10\")\n\n# Check inferred datetime and past patterns\nprint(df[[\"code\", \"name\", \"datetime\", \"inferred_datetime\", \"past_datetimes\"]])\n</code></pre>"},{"location":"guide/sources/","title":"Data Sources","text":"<p>pykabu-calendar aggregates earnings calendar data from multiple sources, each with different characteristics.</p>"},{"location":"guide/sources/#available-sources","title":"Available Sources","text":"Source Browser Required Speed Notes <code>matsui</code> No Fast Lightweight, default <code>tradersweb</code> No Fast Lightweight, default <code>sbi</code> Yes (Playwright) Slow Most comprehensive"},{"location":"guide/sources/#sbi-securities","title":"SBI Securities","text":"<p>The SBI calendar is the most comprehensive public source for Japanese earnings dates.</p> <p>URL: <code>https://www.sbisec.co.jp/...</code></p> <p>Data provided:</p> <ul> <li>Announcement date and time</li> <li>Company code and name</li> </ul> <p>Requires: Playwright browser automation</p> <pre><code>pip install playwright\nplaywright install chromium\n</code></pre> <pre><code>df = cal.get_calendar(\"2026-02-10\", include_sbi=True)\n</code></pre>"},{"location":"guide/sources/#matsui-securities","title":"Matsui Securities","text":"<p>Lightweight source that doesn't require browser automation.</p> <p>URL: <code>https://finance.matsui.co.jp/...</code></p> <p>Data provided:</p> <ul> <li>Announcement date and time</li> <li>Company code and name</li> </ul> <pre><code># Used by default\ndf = cal.get_calendar(\"2026-02-10\")\n\n# Or directly\ndf = cal.get_matsui(\"2026-02-10\")\n</code></pre>"},{"location":"guide/sources/#tradersweb","title":"Tradersweb","text":"<p>Independent source that can catch discrepancies with Matsui.</p> <p>URL: <code>https://www.traders.co.jp/...</code></p> <p>Data provided:</p> <ul> <li>Announcement date and time</li> <li>Company code and name</li> </ul> <pre><code># Used by default\ndf = cal.get_calendar(\"2026-02-10\")\n\n# Or directly\ndf = cal.get_tradersweb(\"2026-02-10\")\n</code></pre>"},{"location":"guide/sources/#historical-inference","title":"Historical Inference","text":"<p>Uses past announcement patterns from pykabutan to predict timing.</p> <p>Logic:</p> <ol> <li>Fetch past N earnings announcement times</li> <li>Detect patterns (e.g., \"always 13:00\", \"always after close\")</li> <li>Assign confidence based on consistency</li> </ol> <p>Example patterns:</p> <ul> <li>Company always announces at 13:00 \u2192 high confidence</li> <li>Company varies between 11:00-15:00 \u2192 low confidence</li> <li>Company always announces after 15:30 \u2192 not significant for trading</li> </ul> <pre><code># Enabled by default\ndf = cal.get_calendar(\"2026-02-10\", infer_from_history=True)\n\n# View past earnings times for a specific stock\npast = cal.get_past_earnings(\"7203\")  # Toyota\n</code></pre>"},{"location":"guide/sources/#datetime-selection-priority","title":"Datetime Selection Priority","text":"<p>When multiple sources provide different times:</p> <ol> <li>Inferred + Source match - When inferred time matches a source (high confidence)</li> <li>Inferred - From historical patterns</li> <li>SBI - Primary public source</li> <li>Matsui - Lightweight source</li> <li>Tradersweb - Lightweight source</li> </ol> <p>The <code>candidate_datetimes</code> column contains all possible times, ordered by confidence.</p>"}]}